language: php

branches:
  only:
    - master
    - 2.x
    - 1.x

env:
  global:
      - XDEBUG_MODE=coverage

php:
  - 7.2
  - 7.3
  - 7.4
  - nightly

jobs:
  allow_failures:
    - php: nightly

before_script:
  - composer install

script:
  - "./vendor/bin/codecept run -o 'settings: shuffle: true' -q --no-colors --coverage-xml"
  - if [[ ${TRAVIS_PHP_VERSION:0:3} == "7.4" ]]; then ./vendor/bin/infection --min-covered-msi=70 --threads=4 --no-progress --log-verbosity="none"; fi

after_script:
  - ./vendor/bin/php-coveralls
