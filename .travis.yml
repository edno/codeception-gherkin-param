language: php

branches:
  only:
    - main

env:
  global:
      - XDEBUG_MODE=coverage

php:
  - 7.2
  - 7.3
  - 7.4
  - 8.0

jobs:
  allow_failures:
    - php: 8.0

before_script:
  - if [[ ${TRAVIS_PHP_VERSION:0:3} == "7.2" || ${TRAVIS_PHP_VERSION:0:3} == "7.3" ]]; then composer require --dev composer/package-versions-deprecated; fi
  - composer install

script:
  - "./vendor/bin/codecept run -q --no-colors --coverage-xml"
  - if [[ ${TRAVIS_PHP_VERSION:0:3} == "7.4" ]]; then ./vendor/bin/infection --min-covered-msi=70 --threads=4 --no-progress --log-verbosity="none"; fi

after_script:
  - if [[ ${TRAVIS_PHP_VERSION:0:3} == "7.4" ]]; then ./vendor/bin/php-coveralls; fi
